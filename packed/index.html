<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <title>落圍棋 GO48</title> <style>html{image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges}body{background-color:black;background-image:url("bg.png");background-size:cover;image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges;text-align:center;margin-left:auto;margin-right:auto}canvas{width:90vw;height:90vh;object-fit:contain}</style> </head> <body> <canvas id="game" width="85" height="70" touch-action="none"></canvas> <script type="text/javascript">var muted=!1,unitTesting=!1;</script> <script>var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.getGlobal=function(t){return"undefined"!=typeof window&&window===t?t:"undefined"!=typeof global&&null!=global?global:t},$jscomp.global=$jscomp.getGlobal(this),$jscomp.checkEs6ConformanceViaProxy=function(){try{var t={},e=Object.create(new $jscomp.global.Proxy(t,{get:function(n,o,r){return n==t&&"q"==o&&r==e}}));return!0===e.q}catch(t){return!1}},$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy(),$jscomp.arrayIteratorImpl=function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}},$jscomp.arrayIterator=function(t){return{next:$jscomp.arrayIteratorImpl(t)}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.SymbolClass=function(t,e){this.$jscomp$symbol$id_=t,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:e})},$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_},$jscomp.Symbol=function(){function t(n){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(n||"")+"_"+e++,n)}var e=0;return t}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var t=$jscomp.global.Symbol.iterator;t||(t=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator")),"function"!=typeof Array.prototype[t]&&$jscomp.defineProperty(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}}),$jscomp.initSymbolIterator=function(){}},$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var t=$jscomp.global.Symbol.asyncIterator;t||(t=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator")),$jscomp.initSymbolAsyncIterator=function(){}},$jscomp.iteratorPrototype=function(t){return $jscomp.initSymbolIterator(),t={next:t},t[$jscomp.global.Symbol.iterator]=function(){return this},t},$jscomp.makeIterator=function(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):$jscomp.arrayIterator(t)},$jscomp.owns=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},$jscomp.polyfill=function(t,e,n,o){if(e){for(n=$jscomp.global,t=t.split("."),o=0;o<t.length-1;o++){var r=t[o];r in n||(n[r]={}),n=n[r]}t=t[t.length-1],o=n[t],e=e(o),e!=o&&null!=e&&$jscomp.defineProperty(n,t,{configurable:!0,writable:!0,value:e})}},$jscomp.polyfill("WeakMap",function(t){function e(){}function n(t){var e=typeof t;return"object"===e&&null!==t||"function"===e}function o(t){if(!$jscomp.owns(t,i)){var n=new e;$jscomp.defineProperty(t,i,{value:n})}}function r(t){var n=Object[t];n&&(Object[t]=function(t){return t instanceof e?t:(o(t),n(t))})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&$jscomp.ES6_CONFORMANCE)return t}else if(function(){if(!t||!Object.seal)return!1;try{var e=Object.seal({}),n=Object.seal({}),o=new t([[e,2],[n,3]]);return 2==o.get(e)&&3==o.get(n)&&(o.delete(e),o.set(n,4),!o.has(e)&&4==o.get(n))}catch(t){return!1}}())return t;var i="$jscomp_hidden_"+Math.random();r("freeze"),r("preventExtensions"),r("seal");var s=0,a=function(t){if(this.id_=(s+=Math.random()+1).toString(),t){t=$jscomp.makeIterator(t);for(var e;!(e=t.next()).done;)e=e.value,this.set(e[0],e[1])}};return a.prototype.set=function(t,e){if(!n(t))throw Error("Invalid WeakMap key");if(o(t),!$jscomp.owns(t,i))throw Error("WeakMap key fail: "+t);return t[i][this.id_]=e,this},a.prototype.get=function(t){return n(t)&&$jscomp.owns(t,i)?t[i][this.id_]:void 0},a.prototype.has=function(t){return n(t)&&$jscomp.owns(t,i)&&$jscomp.owns(t[i],this.id_)},a.prototype.delete=function(t){return!!(n(t)&&$jscomp.owns(t,i)&&$jscomp.owns(t[i],this.id_))&&delete t[i][this.id_]},a},"es6","es3"),$jscomp.MapEntry=function(){},$jscomp.polyfill("Map",function(t){if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(t&&$jscomp.ES6_CONFORMANCE)return t}else if(function(){if($jscomp.ASSUME_NO_NATIVE_MAP||!t||"function"!=typeof t||!t.prototype.entries||"function"!=typeof Object.seal)return!1;try{var e=Object.seal({x:4}),n=new t($jscomp.makeIterator([[e,"s"]]));if("s"!=n.get(e)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var o=n.entries(),r=o.next();return!r.done&&r.value[0]==e&&"s"==r.value[1]&&(r=o.next(),!(r.done||4!=r.value[0].x||"t"!=r.value[1]||!o.next().done))}catch(t){return!1}}())return t;$jscomp.initSymbolIterator();var e=new WeakMap,n=function(t){if(this.data_={},this.head_=i(),this.size=0,t){t=$jscomp.makeIterator(t);for(var e;!(e=t.next()).done;)e=e.value,this.set(e[0],e[1])}};n.prototype.set=function(t,e){t=0===t?0:t;var n=o(this,t);return n.list||(n.list=this.data_[n.id]=[]),n.entry?n.entry.value=e:(n.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:t,value:e},n.list.push(n.entry),this.head_.previous.next=n.entry,this.head_.previous=n.entry,this.size++),this},n.prototype.delete=function(t){return t=o(this,t),!(!t.entry||!t.list)&&(t.list.splice(t.index,1),t.list.length||delete this.data_[t.id],t.entry.previous.next=t.entry.next,t.entry.next.previous=t.entry.previous,t.entry.head=null,this.size--,!0)},n.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=i(),this.size=0},n.prototype.has=function(t){return!!o(this,t).entry},n.prototype.get=function(t){return(t=o(this,t).entry)&&t.value},n.prototype.entries=function(){return r(this,function(t){return[t.key,t.value]})},n.prototype.keys=function(){return r(this,function(t){return t.key})},n.prototype.values=function(){return r(this,function(t){return t.value})},n.prototype.forEach=function(t,e){for(var n,o=this.entries();!(n=o.next()).done;)n=n.value,t.call(e,n[1],n[0],this)},n.prototype[Symbol.iterator]=n.prototype.entries;var o=function(t,n){var o=n&&typeof n;"object"==o||"function"==o?e.has(n)?o=e.get(n):(o=""+ ++s,e.set(n,o)):o="p_"+n;var r=t.data_[o];if(r&&$jscomp.owns(t.data_,o))for(t=0;t<r.length;t++){var i=r[t];if(n!==n&&i.key!==i.key||n===i.key)return{id:o,list:r,index:t,entry:i}}return{id:o,list:r,index:-1,entry:void 0}},r=function(t,e){var n=t.head_;return $jscomp.iteratorPrototype(function(){if(n){for(;n.head!=t.head_;)n=n.previous;for(;n.next!=n.head;)return n=n.next,{done:!1,value:e(n)};n=null}return{done:!0,value:void 0}})},i=function(){var t={};return t.previous=t.next=t.head=t},s=0;return n},"es6","es3"),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PointerEventsPolyfill=e()}(this,function(){function t(t,e){e=e||Object.create(null);var n=document.createEvent("Event");n.initEvent(t,e.bubbles||!1,e.cancelable||!1),t=2;for(var o;t<u.length;t++)o=u[t],n[o]=e[o]||c[t];return n.buttons=e.buttons||0,t=e.pressure&&n.buttons?e.pressure:n.buttons?.5:0,n.x=n.clientX,n.y=n.clientY,n.pointerId=e.pointerId||0,n.width=e.width||0,n.height=e.height||0,n.pressure=t,n.tiltX=e.tiltX||0,n.tiltY=e.tiltY||0,n.twist=e.twist||0,n.tangentialPressure=e.tangentialPressure||0,n.pointerType=e.pointerType||"",n.hwTimestamp=e.hwTimestamp||0,n.isPrimary=e.isPrimary||!1,n}function e(){this.array=[],this.size=0}function n(t,e,n,o){this.addCallback=t.bind(o),this.removeCallback=e.bind(o),this.changedCallback=n.bind(o),S&&(this.observer=new S(this.mutationWatcher.bind(this)))}function o(t){return"body /shadow-deep/ "+r(t)}function r(t){return'[touch-action="'+t+'"]'}function i(t){return"{ -ms-touch-action: "+t+"; touch-action: "+t+"; }"}function s(t){if(!v.pointermap.has(t))throw t=Error("InvalidPointerId"),t.name="InvalidPointerId",t}function a(t){for(var e=t.parentNode;e&&e!==t.ownerDocument;)e=e.parentNode;if(!e)throw t=Error("InvalidStateError"),t.name="InvalidStateError",t}var u="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),c=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],l=window.Map&&window.Map.prototype.forEach?Map:e;e.prototype={set:function(t,e){if(void 0===e)return this.delete(t);this.has(t)||this.size++,this.array[t]=e},has:function(t){return void 0!==this.array[t]},delete:function(t){this.has(t)&&(delete this.array[t],this.size--)},get:function(t){return this.array[t]},clear:function(){this.size=this.array.length=0},forEach:function(t,e){return this.array.forEach(function(n,o){t.call(e,n,o,this)},this)}};var h="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),p=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],f={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},d="undefined"!=typeof SVGElementInstance,v={pointermap:new l,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(t,e){var n=e.events;n&&(n.forEach(function(t){e[t]&&(this.eventMap[t]=e[t].bind(e))},this),this.eventSources[t]=e,this.eventSourceList.push(e))},register:function(t){for(var e,n=this.eventSourceList.length,o=0;o<n&&(e=this.eventSourceList[o]);o++)e.register.call(e,t)},unregister:function(t){for(var e,n=this.eventSourceList.length,o=0;o<n&&(e=this.eventSourceList[o]);o++)e.unregister.call(e,t)},contains:function(t,e){try{return t.contains(e)}catch(t){return!1}},down:function(t){t.bubbles=!0,this.fireEvent("pointerdown",t)},move:function(t){t.bubbles=!0,this.fireEvent("pointermove",t)},up:function(t){t.bubbles=!0,this.fireEvent("pointerup",t)},enter:function(t){t.bubbles=!1,this.fireEvent("pointerenter",t)},leave:function(t){t.bubbles=!1,this.fireEvent("pointerleave",t)},over:function(t){t.bubbles=!0,this.fireEvent("pointerover",t)},out:function(t){t.bubbles=!0,this.fireEvent("pointerout",t)},cancel:function(t){t.bubbles=!0,this.fireEvent("pointercancel",t)},leaveOut:function(t){this.out(t),this.propagate(t,this.leave,!1)},enterOver:function(t){this.over(t),this.propagate(t,this.enter,!0)},eventHandler:function(t){if(!t._handledByPE){var e=t.type;(e=this.eventMap&&this.eventMap[e])&&e(t),t._handledByPE=!0}},listen:function(t,e){e.forEach(function(e){this.addEvent(t,e)},this)},unlisten:function(t,e){e.forEach(function(e){this.removeEvent(t,e)},this)},addEvent:function(t,e){t.addEventListener(e,this.boundHandler)},removeEvent:function(t,e){t.removeEventListener(e,this.boundHandler)},makeEvent:function(e,n){return this.captureInfo[n.pointerId]&&(n.relatedTarget=null),e=new t(e,n),n.preventDefault&&(e.preventDefault=n.preventDefault),e._target=e._target||n.target,e},fireEvent:function(t,e){return t=this.makeEvent(t,e),this.dispatchEvent(t)},cloneEvent:function(t){for(var e,n=Object.create(null),o=0;o<h.length;o++)e=h[o],n[e]=t[e]||p[o],d&&("target"===e||"relatedTarget"===e)&&n[e]instanceof SVGElementInstance&&(n[e]=n[e].correspondingUseElement);return t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n},getTarget:function(t){var e=this.captureInfo[t.pointerId];return e?t._target!==e&&t.type in f?void 0:e:t._target},propagate:function(t,e,n){for(var o=t.target,r=[];o!==document&&!o.contains(t.relatedTarget);)if(r.push(o),!(o=o.parentNode))return;n&&r.reverse(),r.forEach(function(n){t.target=n,e.call(this,t)},this)},setCapture:function(e,n,o){this.captureInfo[e]&&this.releaseCapture(e,o),this.captureInfo[e]=n,this.implicitRelease=this.releaseCapture.bind(this,e,o),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease);var r=new t("gotpointercapture");r.pointerId=e,r._target=n,o||this.asyncDispatchEvent(r)},releaseCapture:function(e,n){var o=this.captureInfo[e];if(o){this.captureInfo[e]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease);var r=new t("lostpointercapture");r.pointerId=e,r._target=o,n||this.asyncDispatchEvent(r)}},dispatchEvent:function(t){var e=this.getTarget(t);if(e)return e.dispatchEvent(t)},asyncDispatchEvent:function(t){requestAnimationFrame(this.dispatchEvent.bind(this,t))}};v.boundHandler=v.eventHandler.bind(v);var m={shadow:function(t){if(t)return t.shadowRoot||t.webkitShadowRoot},canTarget:function(t){return t&&!!t.elementFromPoint},targetingShadow:function(t){if(t=this.shadow(t),this.canTarget(t))return t},olderShadow:function(t){var e=t.olderShadowRoot;return!e&&(t=t.querySelector("shadow"))&&(e=t.olderShadowRoot),e},allShadows:function(t){var e=[];for(t=this.shadow(t);t;)e.push(t),t=this.olderShadow(t);return e},searchRoot:function(t,e,n){if(t){var o,r=t.elementFromPoint(e,n);for(o=this.targetingShadow(r);o;){if(t=o.elementFromPoint(e,n))return r=this.targetingShadow(t),this.searchRoot(r,e,n)||t;o=this.olderShadow(o)}return r}},owner:function(t){for(;t.parentNode;)t=t.parentNode;return t.nodeType!==Node.DOCUMENT_NODE&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(t=document),t},findTarget:function(t){var e=t.clientX,n=t.clientY;return t=this.owner(t.target),t.elementFromPoint(e,n)||(t=document),this.searchRoot(t,e,n)}},y=Array.prototype.forEach.call.bind(Array.prototype.forEach),b=Array.prototype.map.call.bind(Array.prototype.map),E=Array.prototype.slice.call.bind(Array.prototype.slice),g=Array.prototype.filter.call.bind(Array.prototype.filter),S=window.MutationObserver||window.WebKitMutationObserver,T={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};n.prototype={watchSubtree:function(t){this.observer&&m.canTarget(t)&&this.observer.observe(t,T)},enableOnSubtree:function(t){this.watchSubtree(t),t===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(t)},installNewSubtree:function(t){y(this.findElements(t),this.addElement,this)},findElements:function(t){return t.querySelectorAll?t.querySelectorAll("[touch-action]"):[]},removeElement:function(t){this.removeCallback(t)},addElement:function(t){this.addCallback(t)},elementChanged:function(t,e){this.changedCallback(t,e)},concatLists:function(t,e){return t.concat(E(e))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(t){return t.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(t){var e=b(t,this.findElements,this);return e.push(g(t,this.isElement)),e.reduce(this.concatLists,[])},mutationWatcher:function(t){t.forEach(this.mutationHandler,this)},mutationHandler:function(t){"childList"===t.type?(this.flattenMutationTree(t.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(t.removedNodes).forEach(this.removeElement,this)):"attributes"===t.type&&this.elementChanged(t.target,t.oldValue)}};var w=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],P="",O=window.PointerEvent||window.MSPointerEvent,j=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,_=v.pointermap,I=[1,4,2,8,16],$=!1;try{$=1===new MouseEvent("test",{buttons:1}).buttons}catch(t){}var M={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(t){v.listen(t,this.events)},unregister:function(t){v.unlisten(t,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(t){var e=this.lastTouches,n=t.clientX;t=t.clientY;for(var o,r=0,i=e.length;r<i&&(o=e[r]);r++){var s=Math.abs(t-o.y);if(25>=Math.abs(n-o.x)&&25>=s)return!0}},prepareEvent:function(t){var e=v.cloneEvent(t),n=e.preventDefault;return e.preventDefault=function(){t.preventDefault(),n()},e.pointerId=this.POINTER_ID,e.isPrimary=!0,e.pointerType=this.POINTER_TYPE,e},prepareButtonsForMove:function(t,e){var n=_.get(this.POINTER_ID);t.buttons=0!==e.which&&n?n.buttons:0,e.buttons=t.buttons},mousedown:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=_.get(this.POINTER_ID),n=this.prepareEvent(t);$||(n.buttons=I[n.button],e&&(n.buttons|=e.buttons),t.buttons=n.buttons),_.set(this.POINTER_ID,t),e&&0!==e.buttons?v.move(n):v.down(n)}},mousemove:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);$||this.prepareButtonsForMove(e,t),e.button=-1,_.set(this.POINTER_ID,t),v.move(e)}},mouseup:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=_.get(this.POINTER_ID),n=this.prepareEvent(t);if(!$){var o=I[n.button];n.buttons=e?e.buttons&~o:0,t.buttons=n.buttons}_.set(this.POINTER_ID,t),n.buttons&=~I[n.button],0===n.buttons?v.up(n):v.move(n)}},mouseover:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);$||this.prepareButtonsForMove(e,t),e.button=-1,_.set(this.POINTER_ID,t),v.enterOver(e)}},mouseout:function(t){if(!this.isEventSimulatedFromTouch(t)){var e=this.prepareEvent(t);$||this.prepareButtonsForMove(e,t),e.button=-1,v.leaveOut(e)}},cancel:function(t){t=this.prepareEvent(t),v.cancel(t),this.deactivateMouse()},deactivateMouse:function(){_.delete(this.POINTER_ID)}},C=v.captureInfo,R=m.findTarget.bind(m),N=m.allShadows.bind(m),x=v.pointermap,Y={events:["touchstart","touchmove","touchend","touchcancel"],register:function(t){A.enableOnSubtree(t)},unregister:function(){},elementAdded:function(t){var e=t.getAttribute("touch-action"),n=this.touchActionToScrollType(e);n&&(t._scrollType=n,v.listen(t,this.events),N(t).forEach(function(t){t._scrollType=n,v.listen(t,this.events)},this))},elementRemoved:function(t){t._scrollType=void 0,v.unlisten(t,this.events),N(t).forEach(function(t){t._scrollType=void 0,v.unlisten(t,this.events)},this)},elementChanged:function(t,e){var n=t.getAttribute("touch-action"),o=this.touchActionToScrollType(n);e=this.touchActionToScrollType(e),o&&e?(t._scrollType=o,N(t).forEach(function(t){t._scrollType=o},this)):e?this.elementRemoved(t):o&&this.elementAdded(t)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(t){var e=this.scrollTypes;return"none"===t?"none":t===e.XSCROLLER?"X":t===e.YSCROLLER?"Y":e.SCROLLER.exec(t)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(t){return this.firstTouch===t.identifier},setPrimaryTouch:function(t){(0===x.size||1===x.size&&x.has(1))&&(this.firstTouch=t.identifier,this.firstXY={X:t.clientX,Y:t.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(t){t.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var t=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(t,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(t){var e=0;return"touchstart"!==t&&"touchmove"!==t||(e=1),e},touchToPointer:function(t){var e=this.currentTouchEvent,n=v.cloneEvent(t),o=n.pointerId=t.identifier+2;n.target=C[o]||R(n),n.bubbles=!0,n.cancelable=!0,n.detail=this.clickCount,n.button=0,n.buttons=this.typeToButtons(e.type),n.width=2*(t.radiusX||t.webkitRadiusX||0),n.height=2*(t.radiusY||t.webkitRadiusY||0),n.pressure=t.force||t.webkitForce||.5,n.isPrimary=this.isPrimaryTouch(t),n.pointerType=this.POINTER_TYPE,n.altKey=e.altKey,n.ctrlKey=e.ctrlKey,n.metaKey=e.metaKey,n.shiftKey=e.shiftKey;var r=this;return n.preventDefault=function(){r.scrolling=!1,r.firstXY=null,e.preventDefault()},n},processTouches:function(t,e){var n=t.changedTouches;this.currentTouchEvent=t,t=0;for(var o;t<n.length;t++)o=n[t],e.call(this,this.touchToPointer(o))},shouldScroll:function(t){if(this.firstXY){var e=t.currentTarget._scrollType;if("none"===e)e=!1;else if("XY"===e)e=!0;else{t=t.changedTouches[0];var n="Y"===e?"X":"Y";e=Math.abs(t["client"+e]-this.firstXY[e])>=Math.abs(t["client"+n]-this.firstXY[n])}return this.firstXY=null,e}},findTouch:function(t,e){for(var n,o=0,r=t.length;o<r&&(n=t[o]);o++)if(n.identifier===e)return!0},vacuumTouches:function(t){var e=t.touches;if(x.size>=e.length){var n=[];x.forEach(function(t,o){1===o||this.findTouch(e,o-2)||n.push(t.out)},this),n.forEach(this.cancelOut,this)}},touchstart:function(t){this.vacuumTouches(t),this.setPrimaryTouch(t.changedTouches[0]),this.dedupSynthMouse(t),this.scrolling||(this.clickCount++,this.processTouches(t,this.overDown))},overDown:function(t){x.set(t.pointerId,{target:t.target,out:t,outTarget:t.target}),v.enterOver(t),v.down(t)},touchmove:function(t){this.scrolling||(this.shouldScroll(t)?(this.scrolling=!0,this.touchcancel(t)):(t.preventDefault(),this.processTouches(t,this.moveOverOut)))},moveOverOut:function(t){var e=x.get(t.pointerId);if(e){var n=e.out,o=e.outTarget;v.move(t),n&&o!==t.target&&(n.relatedTarget=t.target,t.relatedTarget=o,n.target=o,t.target?(v.leaveOut(n),v.enterOver(t)):(t.target=o,t.relatedTarget=null,this.cancelOut(t))),e.out=t,e.outTarget=t.target}},touchend:function(t){this.dedupSynthMouse(t),this.processTouches(t,this.upOut)},upOut:function(t){this.scrolling||(v.up(t),v.leaveOut(t)),this.cleanUpPointer(t)},touchcancel:function(t){this.processTouches(t,this.cancelOut)},cancelOut:function(t){v.cancel(t),v.leaveOut(t),this.cleanUpPointer(t)},cleanUpPointer:function(t){x.delete(t.pointerId),this.removePrimaryPointer(t)},dedupSynthMouse:function(t){var e=M.lastTouches;t=t.changedTouches[0],this.isPrimaryTouch(t)&&(t={x:t.clientX,y:t.clientY},e.push(t),e=function(t,e){-1<(e=t.indexOf(e))&&t.splice(e,1)}.bind(null,e,t),setTimeout(e,2500))}},A=new n(Y.elementAdded,Y.elementRemoved,Y.elementChanged,Y),k=v.pointermap,L=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,D={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(t){v.listen(t,this.events)},unregister:function(t){v.unlisten(t,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(t){var e=t;return L&&(e=v.cloneEvent(t),e.pointerType=this.POINTER_TYPES[t.pointerType]),e},cleanup:function(t){k.delete(t)},MSPointerDown:function(t){k.set(t.pointerId,t),t=this.prepareEvent(t),v.down(t)},MSPointerMove:function(t){t=this.prepareEvent(t),v.move(t)},MSPointerUp:function(t){var e=this.prepareEvent(t);v.up(e),this.cleanup(t.pointerId)},MSPointerOut:function(t){t=this.prepareEvent(t),v.leaveOut(t)},MSPointerOver:function(t){t=this.prepareEvent(t),v.enterOver(t)},MSPointerCancel:function(t){var e=this.prepareEvent(t);v.cancel(e),this.cleanup(t.pointerId)},MSLostPointerCapture:function(t){t=v.makeEvent("lostpointercapture",t),v.dispatchEvent(t)},MSGotPointerCapture:function(t){t=v.makeEvent("gotpointercapture",t),v.dispatchEvent(t)}};if(window.navigator.msPointerEnabled)var X=function(t){s(t),a(this),0!==v.pointermap.get(t).buttons&&(v.setCapture(t,this,!0),this.msSetPointerCapture(t))},F=function(t){s(t),v.releaseCapture(t,!0),this.msReleasePointerCapture(t)};else X=function(t){s(t),a(this),0!==v.pointermap.get(t).buttons&&v.setCapture(t,this)},F=function(t){s(t),v.releaseCapture(t)};var K=function(t){return!!v.captureInfo[t]};return function(){if(O){w.forEach(function(t){String(t)===t?(P+=r(t)+i(t)+"\n",j&&(P+=o(t)+i(t)+"\n")):(P+=t.selectors.map(r)+i(t.rule)+"\n",j&&(P+=t.selectors.map(o)+i(t.rule)+"\n"))});var t=document.createElement("style");t.textContent=P,document.head.appendChild(t)}}(),window.PointerEvent||(window.PointerEvent=t,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,enumerable:!0}),v.registerSource("ms",D)):(Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),v.registerSource("mouse",M),void 0!==window.ontouchstart&&v.registerSource("touch",Y)),v.register(document)),window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:X},releasePointerCapture:{value:F},hasPointerCapture:{value:K}}),{dispatcher:v,Installer:n,PointerEvent:t,PointerMap:l,targetFinding:m}});</script> <script>function RC4(t){this.s=Array(256);for(var i=this.j=this.i=0;256>i;i++)this.s[i]=i;t&&this.mix(t)}function print_call_stack(){console.log(Error().stack)}function RNG(t){this.seed=t,null==t?t=(Math.random()+Date.now()).toString():"function"==typeof t?(this.uniform=t,this.nextByte=function(){return~~(256*this.uniform())},t=null):"[object String]"!==Object.prototype.toString.call(t)&&(t=JSON.stringify(t)),this._normal=null,this._state=t?new RC4(t):null}String.prototype.getBytes=function(){for(var t=[],i=0;i<this.length;i++){var o=this.charCodeAt(i),n=[];do{n.push(255&o),o>>=8}while(0<o);t=t.concat(n.reverse())}return t},RC4.prototype._swap=function(t,i){var o=this.s[t];this.s[t]=this.s[i],this.s[i]=o},RC4.prototype.mix=function(t){t=t.getBytes();for(var i=0,o=0;o<this.s.length;o++)i+=this.s[o]+t[o%t.length],i%=256,this._swap(o,i)},RC4.prototype.next=function(){return this.i=(this.i+1)%256,this.j=(this.j+this.s[this.i])%256,this._swap(this.i,this.j),this.s[(this.s[this.i]+this.s[this.j])%256]},RNG.prototype.nextByte=function(){return this._state.next()},RNG.prototype.uniform=function(){for(var t=0,i=0;7>i;i++)t*=256,t+=this.nextByte();return t/(Math.pow(2,56)-1)},RNG.prototype.random=function(t,i){return null==t?this.uniform():(null==i&&(i=t,t=0),t+Math.floor(this.uniform()*(i-t)))},RNG.prototype.normal=function(){if(null!==this._normal){var t=this._normal;return this._normal=null,t}t=this.uniform()||Math.pow(2,-53);var i=this.uniform();return this._normal=Math.sqrt(-2*Math.log(t))*Math.sin(2*Math.PI*i),Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*i)},RNG.prototype.exponential=function(){return-Math.log(this.uniform()||Math.pow(2,-53))},RNG.prototype.poisson=function(t){t=Math.exp(-(t||1));var i=0,o=1;do{i++,o*=this.uniform()}while(o>t);return i-1},RNG.prototype.gamma=function(t){var i=(1>t?1+t:t)-1/3,o=1/Math.sqrt(9*i);do{do{var n=this.normal(),r=Math.pow(o*n+1,3)}while(0>=r);var s=this.uniform();n=Math.pow(n,2)}while(s>=1-.0331*n*n&&Math.log(s)>=.5*n+i*(1-r+Math.log(r)));return 1>t?i*r*Math.exp(this.exponential()/-t):i*r},RNG.roller=function(t,i){t=t.split(/(\d+)?d(\d+)([+-]\d+)?/).slice(1);var o=parseFloat(t[0])||1,n=parseFloat(t[1]),r=parseFloat(t[2])||0;return i=i||new RNG,function(){for(var t=o+r,s=0;s<o;s++)t+=i.random(n);return t}};</script> <script>function checkAudioContextExists(){try{null==AUDIO_CONTEXT&&("undefined"!=typeof AudioContext?AUDIO_CONTEXT=new AudioContext:"undefined"!=typeof webkitAudioContext&&(AUDIO_CONTEXT=new webkitAudioContext))}catch(e){window.console.log(e)}}function Params(){var e={};return e.wave_type=SQUARE,e.p_env_attack=0,e.p_env_sustain=.3,e.p_env_punch=0,e.p_env_decay=.4,e.p_base_freq=.3,e.p_freq_limit=0,e.p_freq_ramp=0,e.p_freq_dramp=0,e.p_vib_strength=0,e.p_vib_speed=0,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=0,e.p_duty_ramp=0,e.p_repeat_speed=0,e.p_pha_offset=0,e.p_pha_ramp=0,e.p_lpf_freq=1,e.p_lpf_ramp=0,e.p_lpf_resonance=0,e.p_hpf_freq=0,e.p_hpf_ramp=0,e.sound_vol=.5,e.sample_rate=44100,e.bit_depth=8,e}function frnd(e){return seeded?rng.uniform()*e:Math.random()*e}function rnd(e){return seeded?Math.floor(rng.uniform()*(e+1)):Math.floor(Math.random()*(e+1))}function pickupCoin(){var e=Params();if(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=0),e.p_base_freq=.4+frnd(.5),e.p_env_attack=0,e.p_env_sustain=frnd(.1),e.p_env_decay=.1+frnd(.4),e.p_env_punch=.3+frnd(.3),rnd(1)){e.p_arp_speed=.5+frnd(.2);var r=1+(1|frnd(7)),_=r+(1|frnd(7))+2;e.p_arp_mod=+r/+_}return e}function laserShoot(){var e=Params();return e.wave_type=rnd(2),e.wave_type===SINE&&rnd(1)&&(e.wave_type=rnd(1)),e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_base_freq=.5+frnd(.5),e.p_freq_limit=e.p_base_freq-.2-frnd(.6),.2>e.p_freq_limit&&(e.p_freq_limit=.2),e.p_freq_ramp=-.15-frnd(.2),0===rnd(2)&&(e.p_base_freq=.3+frnd(.6),e.p_freq_limit=frnd(.1),e.p_freq_ramp=-.35-frnd(.3)),rnd(1)?(e.p_duty=frnd(.5),e.p_duty_ramp=frnd(.2)):(e.p_duty=.4+frnd(.5),e.p_duty_ramp=-frnd(.7)),e.p_env_attack=0,e.p_env_sustain=.1+frnd(.2),e.p_env_decay=frnd(.4),rnd(1)&&(e.p_env_punch=frnd(.3)),0===rnd(2)&&(e.p_pha_offset=frnd(.2),e.p_pha_ramp=-frnd(.2)),rnd(1)&&(e.p_hpf_freq=frnd(.3)),e}function explosion(){var e=Params();return rnd(1)?(e.p_base_freq=.1+frnd(.4),e.p_freq_ramp=-.1+frnd(.4)):(e.p_base_freq=.2+frnd(.7),e.p_freq_ramp=-.2-frnd(.2)),e.p_base_freq*=e.p_base_freq,0===rnd(4)&&(e.p_freq_ramp=0),0===rnd(2)&&(e.p_repeat_speed=.3+frnd(.5)),e.p_env_attack=0,e.p_env_sustain=.1+frnd(.3),e.p_env_decay=frnd(.5),0===rnd(1)&&(e.p_pha_offset=-.3+frnd(.9),e.p_pha_ramp=-frnd(.3)),e.p_env_punch=.2+frnd(.6),rnd(1)&&(e.p_vib_strength=frnd(.7),e.p_vib_speed=frnd(.6)),0===rnd(2)&&(e.p_arp_speed=.6+frnd(.3),e.p_arp_mod=.8-frnd(1.6)),e}function birdSound(){var e=Params();return 1>frnd(10)?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_env_attack=.4304400932967592+frnd(.2)-.1,e.p_env_sustain=.15739346034252394+frnd(.2)-.1,e.p_env_punch=.004488201744871758+frnd(.2)-.1,e.p_env_decay=.07478075528212291+frnd(.2)-.1,e.p_base_freq=.9865265720147687+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.2995018224359539+frnd(.2)-.1,.5>frnd(1)&&(e.p_freq_ramp=.1+frnd(.15)),e.p_freq_dramp=.004598608156964473+frnd(.1)-.05,e.p_vib_strength=-.2202799497929496+frnd(.2)-.1,e.p_vib_speed=.8084998703158364+frnd(.2)-.1,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=-.9031808754347107+frnd(.2)-.1,e.p_duty_ramp=-.8128699999808343+frnd(.2)-.1,e.p_repeat_speed=.601486018931999+frnd(.2)-.1,e.p_pha_offset=-.9424902314367765+frnd(.2)-.1,e.p_pha_ramp=-.1055482222272056+frnd(.2)-.1,e.p_lpf_freq=.9989765717851521+frnd(.2)-.1,e.p_lpf_ramp=-.25051720626043017+frnd(.2)-.1,e.p_lpf_resonance=.32777871505494693+frnd(.2)-.1,e.p_hpf_freq=.0023548750981756753+frnd(.2)-.1,e.p_hpf_ramp=-.002375673204842568+frnd(.2)-.1,e):1>frnd(10)?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_env_attack=.5277795946672003+frnd(.2)-.1,e.p_env_sustain=.18243733568468432+frnd(.2)-.1,e.p_env_punch=-.020159754546840117+frnd(.2)-.1,e.p_env_decay=.1561353422051903+frnd(.2)-.1,e.p_base_freq=.9028855606533718+frnd(.2)-.1,e.p_freq_limit=-.008842787837148716,e.p_freq_ramp=-.1,e.p_freq_dramp=-.012891241489551925,e.p_vib_strength=-.17923136138403065+frnd(.2)-.1,e.p_vib_speed=.908263385610142+frnd(.2)-.1,e.p_arp_mod=.41690153355414894+frnd(.2)-.1,e.p_arp_speed=.0010766233195860704+frnd(.2)-.1,e.p_duty=-.8735363011184684+frnd(.2)-.1,e.p_duty_ramp=-.7397985366747507+frnd(.2)-.1,e.p_repeat_speed=.0591789344172107+frnd(.2)-.1,e.p_pha_offset=-.9961184222777699+frnd(.2)-.1,e.p_pha_ramp=-.08234769395850523+frnd(.2)-.1,e.p_lpf_freq=.9412475115697335+frnd(.2)-.1,e.p_lpf_ramp=-.18261358925834958+frnd(.2)-.1,e.p_lpf_resonance=.24541438107389477+frnd(.2)-.1,e.p_hpf_freq=-.01831940280978611+frnd(.2)-.1,e.p_hpf_ramp=-.03857383633171346+frnd(.2)-.1,e):1>frnd(10)?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_env_attack=.4304400932967592+frnd(.2)-.1,e.p_env_sustain=.15739346034252394+frnd(.2)-.1,e.p_env_punch=.004488201744871758+frnd(.2)-.1,e.p_env_decay=.07478075528212291+frnd(.2)-.1,e.p_base_freq=.9865265720147687+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.2995018224359539+frnd(.2)-.1,e.p_freq_dramp=.004598608156964473+frnd(.2)-.1,e.p_vib_strength=-.2202799497929496+frnd(.2)-.1,e.p_vib_speed=.8084998703158364+frnd(.2)-.1,e.p_arp_mod=-.46410459213693644+frnd(.2)-.1,e.p_arp_speed=-.10955361249587248+frnd(.2)-.1,e.p_duty=-.9031808754347107+frnd(.2)-.1,e.p_duty_ramp=-.8128699999808343+frnd(.2)-.1,e.p_repeat_speed=.7014860189319991+frnd(.2)-.1,e.p_pha_offset=-.9424902314367765+frnd(.2)-.1,e.p_pha_ramp=-.1055482222272056+frnd(.2)-.1,e.p_lpf_freq=.9989765717851521+frnd(.2)-.1,e.p_lpf_ramp=-.25051720626043017+frnd(.2)-.1,e.p_lpf_resonance=.32777871505494693+frnd(.2)-.1,e.p_hpf_freq=.0023548750981756753+frnd(.2)-.1,e.p_hpf_ramp=-.002375673204842568+frnd(.2)-.1,e):1<frnd(5)?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),rnd(1)?(e.p_arp_mod=.2697849293151393+frnd(.2)-.1,e.p_arp_speed=-.3131172257760948+frnd(.2)-.1,e.p_base_freq=.8090588299313949+frnd(.2)-.1,e.p_duty=-.6210022920964955+frnd(.2)-.1,e.p_duty_ramp=-.00043441813553182567+frnd(.2)-.1,e.p_env_attack=.004321877246874195+frnd(.2)-.1,e.p_env_decay=.1+frnd(.2)-.1,e.p_env_punch=.061737781504416146+frnd(.2)-.1,e.p_env_sustain=.4987252564798832+frnd(.2)-.1,e.p_freq_dramp=.31700340314222614+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.163380391341416+frnd(.2)-.1,e.p_hpf_freq=.4709005021145149+frnd(.2)-.1,e.p_hpf_ramp=.6924667290539194+frnd(.2)-.1,e.p_lpf_freq=.8351398631384511+frnd(.2)-.1,e.p_lpf_ramp=.36616557192873134+frnd(.2)-.1,e.p_lpf_resonance=-.08685777111664439+frnd(.2)-.1,e.p_pha_offset=-.036084571580025544+frnd(.2)-.1,e.p_pha_ramp=-.014806445085568108+frnd(.2)-.1,e.p_repeat_speed=-.8094368475518489+frnd(.2)-.1,e.p_vib_speed=.4496665457171294+frnd(.2)-.1,e.p_vib_strength=.23413762515532424+frnd(.2)-.1):(e.p_arp_mod=-.35697118026766184+frnd(.2)-.1,e.p_arp_speed=.3581140690559588+frnd(.2)-.1,e.p_base_freq=1.3260897696157528+frnd(.2)-.1,e.p_duty=-.30984900436710694+frnd(.2)-.1,e.p_duty_ramp=-.0014374759133411626+frnd(.2)-.1,e.p_env_attack=.3160357835682254+frnd(.2)-.1,e.p_env_decay=.1+frnd(.2)-.1,e.p_env_punch=.24323114016870148+frnd(.2)-.1,e.p_env_sustain=.4+frnd(.2)-.1,e.p_freq_dramp=.2866475886237244+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.10956352368742976+frnd(.2)-.1,e.p_hpf_freq=.20772718017889846+frnd(.2)-.1,e.p_hpf_ramp=.1564090637378835+frnd(.2)-.1,e.p_lpf_freq=.6021372770637031+frnd(.2)-.1,e.p_lpf_ramp=.24016227139979027+frnd(.2)-.1,e.p_lpf_resonance=-.08787383821160144+frnd(.2)-.1,e.p_pha_offset=-.381597686151701+frnd(.2)-.1,e.p_pha_ramp=-.0002481687661373495+frnd(.2)-.1,e.p_repeat_speed=.07812112809425686+frnd(.2)-.1,e.p_vib_speed=-.13648848579133943+frnd(.2)-.1,e.p_vib_strength=.0018874158972302657+frnd(.2)-.1),e):(e.wave_type=Math.floor(frnd(SHAPES.length)),1!==e.wave_type&&3!==e.wave_type||(e.wave_type=2),e.p_base_freq=.85+frnd(.15),e.p_freq_ramp=.3+frnd(.15),e.p_env_attack=0+frnd(.09),e.p_env_sustain=.2+frnd(.3),e.p_env_decay=0+frnd(.1),e.p_duty=frnd(2)-1,e.p_duty_ramp=Math.pow(frnd(2)-1,3),e.p_repeat_speed=.5+frnd(.1),e.p_pha_offset=-.3+frnd(.9),e.p_pha_ramp=-frnd(.3),e.p_arp_speed=.4+frnd(.6),e.p_arp_mod=.8+frnd(.1),e.p_lpf_resonance=frnd(2)-1,e.p_lpf_freq=1-Math.pow(frnd(1),3),e.p_lpf_ramp=Math.pow(frnd(2)-1,3),.1>e.p_lpf_freq&&-.05>e.p_lpf_ramp&&(e.p_lpf_ramp=-e.p_lpf_ramp),e.p_hpf_freq=Math.pow(frnd(1),5),e.p_hpf_ramp=Math.pow(frnd(2)-1,5),e)}function pushSound(){var e=Params();return e.wave_type=Math.floor(frnd(SHAPES.length)),2===e.wave_type&&e.wave_type++,0===e.wave_type&&(e.wave_type=NOISE),e.p_base_freq=.1+frnd(.4),e.p_freq_ramp=.05+frnd(.2),e.p_env_attack=.01+frnd(.09),e.p_env_sustain=.01+frnd(.09),e.p_env_decay=.01+frnd(.09),e.p_repeat_speed=.3+frnd(.5),e.p_pha_offset=-.3+frnd(.9),e.p_pha_ramp=-frnd(.3),e.p_arp_speed=.6+frnd(.3),e.p_arp_mod=.8-frnd(1.6),e}function powerUp(){var e=Params();return rnd(1)?e.wave_type=SAWTOOTH:e.p_duty=frnd(.6),e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),rnd(1)?(e.p_base_freq=.2+frnd(.3),e.p_freq_ramp=.1+frnd(.4),e.p_repeat_speed=.4+frnd(.4)):(e.p_base_freq=.2+frnd(.3),e.p_freq_ramp=.05+frnd(.2),rnd(1)&&(e.p_vib_strength=frnd(.7),e.p_vib_speed=frnd(.6))),e.p_env_attack=0,e.p_env_sustain=frnd(.4),e.p_env_decay=.1+frnd(.4),e}function hitHurt(){var e=Params();return e.wave_type=rnd(2),e.wave_type===SINE&&(e.wave_type=NOISE),e.wave_type===SQUARE&&(e.p_duty=frnd(.6)),e.wave_type=Math.floor(frnd(SHAPES.length)),e.p_base_freq=.2+frnd(.6),e.p_freq_ramp=-.3-frnd(.4),e.p_env_attack=0,e.p_env_sustain=frnd(.1),e.p_env_decay=.1+frnd(.2),rnd(1)&&(e.p_hpf_freq=frnd(.3)),e}function jump(){var e=Params();return e.wave_type=SQUARE,e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_duty=frnd(.6),e.p_base_freq=.3+frnd(.3),e.p_freq_ramp=.1+frnd(.2),e.p_env_attack=0,e.p_env_sustain=.1+frnd(.3),e.p_env_decay=.1+frnd(.2),rnd(1)&&(e.p_hpf_freq=frnd(.3)),rnd(1)&&(e.p_lpf_freq=1-frnd(.6)),e}function blipSelect(){var e=Params();return e.wave_type=rnd(1),e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=rnd(1)),e.wave_type===SQUARE&&(e.p_duty=frnd(.6)),e.p_base_freq=.2+frnd(.4),e.p_env_attack=0,e.p_env_sustain=.1+frnd(.1),e.p_env_decay=frnd(.2),e.p_hpf_freq=.1,e}function random(){var e=Params();return e.wave_type=Math.floor(frnd(SHAPES.length)),e.p_base_freq=Math.pow(frnd(2)-1,2),rnd(1)&&(e.p_base_freq=Math.pow(frnd(2)-1,3)+.5),e.p_freq_limit=0,e.p_freq_ramp=Math.pow(frnd(2)-1,5),.7<e.p_base_freq&&.2<e.p_freq_ramp&&(e.p_freq_ramp=-e.p_freq_ramp),.2>e.p_base_freq&&-.05>e.p_freq_ramp&&(e.p_freq_ramp=-e.p_freq_ramp),e.p_freq_dramp=Math.pow(frnd(2)-1,3),e.p_duty=frnd(2)-1,e.p_duty_ramp=Math.pow(frnd(2)-1,3),e.p_vib_strength=Math.pow(frnd(2)-1,3),e.p_vib_speed=frnd(2)-1,e.p_env_attack=Math.pow(frnd(2)-1,3),e.p_env_sustain=Math.pow(frnd(2)-1,2),e.p_env_decay=frnd(2)-1,e.p_env_punch=Math.pow(frnd(.8),2),.2>e.p_env_attack+e.p_env_sustain+e.p_env_decay&&(e.p_env_sustain+=.2+frnd(.3),e.p_env_decay+=.2+frnd(.3)),e.p_lpf_resonance=frnd(2)-1,e.p_lpf_freq=1-Math.pow(frnd(1),3),e.p_lpf_ramp=Math.pow(frnd(2)-1,3),.1>e.p_lpf_freq&&-.05>e.p_lpf_ramp&&(e.p_lpf_ramp=-e.p_lpf_ramp),e.p_hpf_freq=Math.pow(frnd(1),5),e.p_hpf_ramp=Math.pow(frnd(2)-1,5),e.p_pha_offset=Math.pow(frnd(2)-1,3),e.p_pha_ramp=Math.pow(frnd(2)-1,3),e.p_repeat_speed=frnd(2)-1,e.p_arp_speed=frnd(2)-1,e.p_arp_mod=frnd(2)-1,e}function generateFromSeed(e){rng=new RNG(e/100|0);var r=generators[e%100%generators.length];return seeded=!0,r=r(),r.seed=e,seeded=!1,r}function SoundEffect(e,r){this._buffer=AUDIO_CONTEXT.createBuffer(1,e,r)}function ULBS(){if("suspended"===AUDIO_CONTEXT.state){var e=function(){AUDIO_CONTEXT.resume().then(function(){document.body.removeEventListener("touchstart",e),document.body.removeEventListener("touchend",e),document.body.removeEventListener("mousedown",e),document.body.removeEventListener("mouseup",e),document.body.removeEventListener("keydown",e),document.body.removeEventListener("keyup",e)})};document.body.addEventListener("touchstart",e,!1),document.body.addEventListener("touchend",e,!1),document.body.addEventListener("mousedown",e,!1),document.body.addEventListener("mouseup",e,!1),document.body.addEventListener("keydown",e,!1),document.body.addEventListener("keyup",e,!1)}}function cacheSeed(e){if(e in sfxCache)return sfxCache[e];var r=generateFromSeed(e);for(r.sound_vol=SOUND_VOL,r.sample_rate=SAMPLE_RATE,r.bit_depth=BIT_DEPTH,r=SoundEffect.generate(r),sfxCache[e]=r,cachedSeeds.push(e);cachedSeeds.length>CACHE_MAX;)e=cachedSeeds[0],cachedSeeds=cachedSeeds.slice(1),delete sfxCache[e];return r}function playSound(e){muted||(checkAudioContextExists(),unitTesting||cacheSeed(e).play())}function killAudioButton(){var e=document.getElementById("muteButton"),r=document.getElementById("unMuteButton");e&&(e.remove(),r.remove())}function showAudioButton(){var e=document.getElementById("muteButton"),r=document.getElementById("unMuteButton");e&&(e.style.display="block",r.style.display="none")}function toggleMute(){0===muted?muteAudio():unMuteAudio()}function muteAudio(){muted=1;var e=document.getElementById("muteButton"),r=document.getElementById("unMuteButton");e&&(e.style.display="none",r.style.display="block")}function unMuteAudio(){muted=0;var e=document.getElementById("muteButton"),r=document.getElementById("unMuteButton");e&&(e.style.display="block",r.style.display="none")}var SOUND_VOL=.25,SAMPLE_RATE=5512,BIT_DEPTH=8,SQUARE=0,SAWTOOTH=1,SINE=2,NOISE=3,TRIANGLE=4,BREAKER=5,SHAPES="square sawtooth sine noise triangle breaker".split(" "),AUDIO_CONTEXT;checkAudioContextExists();var masterVolume=1,rng,seeded=!1,generators=[pickupCoin,laserShoot,explosion,powerUp,hitHurt,jump,blipSelect,pushSound,random,birdSound],generatorNames="pickupCoin laserShoot explosion powerUp hitHurt jump blipSelect pushSound random birdSound".split(" ");SoundEffect.prototype.getBuffer=function(){return this._buffer.getChannelData(0)},SoundEffect.prototype.play=function(){ULBS();var e=AUDIO_CONTEXT.createBufferSource(),r=AUDIO_CONTEXT.createBiquadFilter(),_=AUDIO_CONTEXT.createBiquadFilter(),p=AUDIO_CONTEXT.createBiquadFilter();e.buffer=this._buffer,e.connect(r),r.frequency.value=1600,_.frequency.value=1600,p.frequency.value=1600,r.connect(_),_.connect(p),p.connect(AUDIO_CONTEXT.destination),r=AUDIO_CONTEXT.currentTime,void 0!==e.start?e.start(r):e.noteOn(r),e.onended=function(){p.disconnect()}},SoundEffect.MIN_SAMPLE_RATE=22050,void 0===AUDIO_CONTEXT&&(SoundEffect=function(e,r){this._sample_rate=r,this._buffer=Array(e),this._audioElement=null},SoundEffect.prototype.getBuffer=function(){return this._audioElement=null,this._buffer},SoundEffect.prototype.play=function(){this._audioElement?this._audioElement.cloneNode(!1).play():console.log("URR")},SoundEffect.MIN_SAMPLE_RATE=1),SoundEffect.generate=function(e){function r(){_=0,p=100/(e.p_base_freq*e.p_base_freq+.001),F=Math.floor(p),n=100/(e.p_freq_limit*e.p_freq_limit+.001),t=1-.01*Math.pow(e.p_freq_ramp,3),f=1e-6*-Math.pow(e.p_freq_dramp,3),a=.5-.5*e.p_duty,d=5e-5*-e.p_duty_ramp,o=0<=e.p_arp_mod?1-.9*Math.pow(e.p_arp_mod,2):1+10*Math.pow(e.p_arp_mod,2),Q=Math.floor(2e4*Math.pow(1-e.p_arp_speed,2)+32),1==e.p_arp_speed&&(Q=0)}var _,p,n,t,f,a,d,o;r();var u=0,s=0,v=.1*Math.pow(e.p_lpf_freq,3),i=1+1e-4*e.p_lpf_ramp,m=5/(1+20*Math.pow(e.p_lpf_resonance,2))*(.01+v);.8<m&&(m=.8);var h=0,c=.1*Math.pow(e.p_hpf_freq,2),l=1+3e-4*e.p_hpf_ramp,y=0,E=.01*Math.pow(e.p_vib_speed,2),w=.5*e.p_vib_strength,q=0,S=0,M=0,b=[Math.floor(e.p_env_attack*e.p_env_attack*1e5),Math.floor(e.p_env_sustain*e.p_env_sustain*1e5),Math.floor(e.p_env_decay*e.p_env_decay*1e5)],A=b[0]+b[1]+b[2],g=0,T=1020*Math.pow(e.p_pha_offset,2);0>e.p_pha_offset&&(T=-T);var O=1*Math.pow(e.p_pha_ramp,2);0>e.p_pha_ramp&&(O=-O);for(var I=Math.abs(Math.floor(T)),k=0,N=[],P=0;1024>P;++P)N[P]=0;var U=[];for(P=0;32>P;++P)U[P]=2*Math.random()-1;var C=Math.floor(2e4*Math.pow(1-e.p_repeat_speed,2)+32);0==e.p_repeat_speed&&(C=0);var B=Math.exp(e.sound_vol)-1,R=0,L=0,H=Math.floor(44100/e.sample_rate),x=0;I=Math.ceil(A/H),A=e.sample_rate<SoundEffect.MIN_SAMPLE_RATE?new SoundEffect(4*I,SoundEffect.MIN_SAMPLE_RATE):new SoundEffect(I,e.sample_rate);for(var D=A.getBuffer(),X=0;;++X){if(0!=C&&++_>=C&&r(),0!=Q&&X>=Q){var Q=0;p*=o}t+=f,p*=t,p>n&&(p=n),I=p,0<w&&(y+=E,I=p*(1+Math.sin(y)*w));var F=Math.floor(I);if(8>F&&(F=8),a+=d,0>a&&(a=0),.5<a&&(a=.5),++M>b[S]){for(M=1,S++;3>S&&0===b[S];)S++;if(3===S)break}q=0===S?M/b[0]:1===S?1+2*Math.pow(1-M/b[1],1)*e.p_env_punch:1-M/b[2],T+=O,I=Math.abs(Math.floor(T)),1023<I&&(I=1023),0!=l&&(c*=l,1e-5>c&&(c=1e-5),.1<c&&(c=.1));for(var V=0,j=0;8>j;++j){var G=0;if(++g>=F&&(g%=F,e.wave_type===NOISE))for(P=0;32>P;++P)U[P]=2*Math.random()-1;P=g/F,e.wave_type===SQUARE?G=P<a?.5:-.5:e.wave_type===SAWTOOTH?G=1-2*P:e.wave_type===SINE?G=Math.sin(2*P*Math.PI):e.wave_type===NOISE?G=U[Math.floor(32*g/F)]:e.wave_type===TRIANGLE?G=Math.abs(1-2*P)-1:e.wave_type===BREAKER&&(G=Math.abs(1-P*P*2)-1),P=u,v*=i,0>v&&(v=0),.1<v&&(v=.1),1!=e.p_lpf_freq?(s+=(G-u)*v,s-=s*m):(u=G,s=0),u+=s,h+=u-P,G=h-=h*c,N[1023&k]=G,G+=N[k-I+1024&1023],k=k+1&1023,V+=G*q}R+=V,++L>=H&&(L=0,V=R/H,R=0,V=V/8*masterVolume,V*=B,D[x++]=V,e.sample_rate<SoundEffect.MIN_SAMPLE_RATE&&(D[x++]=V,D[x++]=V,D[x++]=V))}return 0<H&&(V=R/H/8*masterVolume,V*=B,D[x++]=V,e.sample_rate<SoundEffect.MIN_SAMPLE_RATE&&(D[x++]=V,D[x++]=V,D[x++]=V)),A};var sfxCache={},cachedSeeds=[],CACHE_MAX=50;</script> <script>function reOffset(){var e=canvas.getBoundingClientRect();offsetX=e.left,offsetY=e.top,cw=canvas.width,ch=canvas.height}function spawnRand(e){clearAnim(),0===e&&(e=.5>Math.random()?1:2);var t=emptyCells(),r=t.splice(Math.floor(Math.random()*t.length),1)[0];state[r[0]][r[1]]=e,spawn[r[0]][r[1]]=1,0===t.length&&(!1===gameover&&playSound(38733900),gameover=!0)}function clearCell(e,t){var r=state[e][t];return 0!==r&&(spawn[e][t]=-r,state[e][t]=0,!0)}function resetGame(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){switch(e.nextAddress){case 1:playSound(90509500),gameover=!1,anim=[[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[0,0],[0,0],[0,0],[0,0]]],state=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],spawn=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],score=phase=anim_phase=0,spawnRand(1),anim_phase=0;case 2:if(!(2>anim_phase)){e.jumpTo(4);break}return redraw(),e.yield(sleep(30),3);case 3:anim_phase++,e.jumpTo(2);break;case 4:clearAnim(),redraw(),spawnRand(2),anim_phase=0;case 6:if(!(2>anim_phase)){e.jumpTo(8);break}return redraw(),e.yield(sleep(30),7);case 7:anim_phase++,e.jumpTo(6);break;case 8:return clearAnim(),redraw(),e.return(Promise.resolve(1))}})}function unpress(){pressed=-1,-1===phase&&(phase=0),redraw()}function animtick(){anim_phase++,anim_phase>anim_frames&&(anim_phase=anim_frames),anim_phase<anim_frames?setTimeout(animtick,anim_length):phase=0,redraw()}function redraw(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(images.geraet2,0,0);for(var e=score.toString();3>e.length;)e="0"+e;for(var t=0;3>t;t++)ctx.drawImage(images[e[t]],54+4*t,10);for(ctx.fillStyle="#00FF00",t=0;t<phase;t++)ctx.fillRect(55+4*t,52,1,1);if(-1===phase&&(ctx.fillStyle="#FF0000",ctx.fillRect(55+4*t,52,1,1)),gameover)for(ctx.fillStyle="#FF0000",t=0;4>t;t++)ctx.fillRect(55+4*t,52,1,1);for(t=0;t<gw;t++)for(e=0;e<gh;e++){var r=Math.floor(8*anim[t][e][0]*(1-anim_phase/anim_frames)),o=Math.floor(8*anim[t][e][1]*(1-anim_phase/anim_frames)),n=0,s=state[t][e];1===spawn[t][e]&&(n=2-anim_phase),-1===spawn[t][e]&&(s=n=1),-2===spawn[t][e]&&(n=1,s=2),1===s?ctx.drawImage(images[piece_frames[s][n]],19+8*t+r,19+8*e+o):2===s&&ctx.drawImage(images[piece_frames[s][n]],19+8*t+r,19+8*e+o)}0<=pressed&&(t=image_x_y[pressed],ctx.drawImage(images[t[0]],t[1],t[2]),setTimeout(unpress,200))}function trypush(e,t){for(var r=!1,o=0;o<gw;o++)for(var n=0;n<gh;n++)if(0!==state[o][n]){var s=o+e,a=n+t;0>s||s>=gw||0>a||a>=gh||0!==state[s][a]||(state[s][a]=state[o][n],state[o][n]=0,anim[s][a][0]=anim[o][n][0]-e,anim[s][a][1]=anim[o][n][1]-t,anim[o][n][0]=0,anim[o][n][1]=0,r=!0)}return r}function sleep(e){return new Promise(function(t){return setTimeout(t,e)})}function clearAnim(){for(var e=0;e<gw;e++)for(var t=0;t<gh;t++)anim[e][t][0]=0,anim[e][t][1]=0,spawn[e][t]=0}function full(){for(var e=0;e<gw;e++)for(var t=0;t<gh;t++)if(0===state[e][t])return!0;return!1}function doMove(e,t){var r,o;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:for(r=!1,clearAnim(),o=!0;o;)o=!1,trypush(e,t)&&(r=o=!0);if(!1!==r){n.jumpTo(2);break}return anim_phase=-1,redraw(),n.yield(sleep(30),3);case 3:return phase=anim_phase=1,redraw(),n.return(Promise.resolve(1));case 2:playSound(11309707),anim_phase=phase=1;case 4:if(!(anim_phase<anim_frames)){if(phase=2,clearAnim(),!tryClear()){n.jumpTo(8);break}return playSound(53413900),n.yield(sleep(30),9)}return redraw(),n.yield(sleep(30),5);case 5:anim_phase++,n.jumpTo(4);break;case 9:anim_phase=0;case 10:return 2>anim_phase?(redraw(),n.yield(sleep(30),11)):(clearAnim(),redraw(),n.yield(sleep(30),8));case 11:anim_phase++,n.jumpTo(10);break;case 8:phase=3,spawnRand(0),anim_phase=0;case 15:if(!(2>anim_phase)){if(clearAnim(),redraw(),phase=4,clearAnim(),!tryClear()){n.jumpTo(19);break}return playSound(53413900),n.yield(sleep(30),20)}return redraw(),n.yield(sleep(30),16);case 16:anim_phase++,n.jumpTo(15);break;case 20:anim_phase=0;case 21:if(!(2>anim_phase)){n.jumpTo(23);break}return redraw(),n.yield(sleep(30),22);case 22:anim_phase++,n.jumpTo(21);break;case 23:clearAnim(),redraw();case 19:return phase=0,redraw(),n.return(Promise.resolve(1))}})}function doPress(e){return $jscomp.asyncExecutePromiseGeneratorProgram(function(t){if(1==t.nextAddress)return!0===moving?t.return():(moving=!0,pressed=e,0===e?t.yield(doMove(0,-1),3):1===e?t.yield(doMove(0,1),3):2===e?t.yield(doMove(-1,0),3):3===e?t.yield(doMove(1,0),3):4!==e?t.jumpTo(3):t.yield(resetGame(),3));moving=!1,t.jumpToEnd()})}function getMousePos(e){var t=canvas.getBoundingClientRect(),r=canvas.width/t.width,o=canvas.height/t.height,n=e.clientX;return e=e.clientY,r<o?(r=o,n-=t.width/2-cw/r/2):(o=r,e-=t.height/2-ch/o/2),[(n-t.left)*r,(e-t.top)*o]}function handleTap(e){var t=$jscomp.makeIterator(getMousePos(e)),r=t.next().value;for(t=t.next().value,console.log(e),console.log(r+","+t),ctx.getImageData(r,t,1,1),e=0;e<image_x_y.length;e++){var o=image_x_y[e],n=o[1],s=o[2],a=o[1]+o[3];o=o[2]+o[4],r>=n&&r<=a&&t>=s&&t<=o&&(console.log("("+r+","+t+")~["+n+","+s+","+a+","+o+"]"),doPress(e))}}function emptyCells(){for(var e=[],t=0;t<gw;t++)for(var r=0;r<gh;r++)0===state[t][r]&&e.push([t,r]);return e}function neighbors(e,t){var r=[];return 0<e&&r.push([e-1,t]),e<gw-1&&r.push([e+1,t]),0<t&&r.push([e,t-1]),t<gh-1&&r.push([e,t+1]),r}function versuchFloodFill(e,t,r){if(0===state[e][t])return!1;var o=state[e][t];if(console.log("farbe "+o),e+=gw*t,0<=r.indexOf(e))return!1;for(console.log("not already present"),e=[e],t=!0;t;){t=!1;for(var n=0;n<gw;n++)for(var s=0;s<gh;s++){var a=n+gw*s;if(!(0<=e.indexOf(a))){for(var i=!1,c=neighbors(n,s),l=0;l<c.length;l++){var p=c[l];0<=e.indexOf(p[0]+gw*p[1])&&(i=!0)}if(!1!==i){if(0==(i=state[n][s]))return!1;i===o&&(e.push(a),t=!0)}}}}for(16===e.length&&(e=[]),n=0;n<e.length;n++)r.push(e[n]);return 0<e.length}function tryClear(){if(0===emptyCells().length)return!1===gameover&&playSound(38733900),gameover=!0,!1;console.log("tryclear");for(var e=[],t=0;t<gw;t++)for(var r=0;r<gh;r++)0!=state[t][r]&&versuchFloodFill(t,r,e)&&score++;for(t=0;t<e.length;t++)r=e[t],clearCell(r%gw,Math.floor(r/gw));return 0<e.length}function handleKey(e){return"ArrowUp"===e.key?(doPress(0),e.preventDefault(),!1):"ArrowDown"===e.key?(doPress(1),e.preventDefault(),!1):"ArrowLeft"===e.key?(doPress(2),e.preventDefault(),!1):"ArrowRight"===e.key?(doPress(3),e.preventDefault(),!1):"r"===e.key.toLowerCase()||"n"===e.key.toLowerCase()?(doPress(4),e.preventDefault(),!1):void 0}var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}},$jscomp.makeIterator=function(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):$jscomp.arrayIterator(e)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value)},$jscomp.polyfill=function(e,t,r,o){if(t){for(r=$jscomp.global,e=e.split("."),o=0;o<e.length-1;o++){var n=e[o];n in r||(r[n]={}),r=r[n]}e=e[e.length-1],o=r[e],t=t(o),t!=o&&null!=t&&$jscomp.defineProperty(r,e,{configurable:!0,writable:!0,value:t})}},$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.polyfill("Promise",function(e){function t(){this.batch_=null}function r(e){return e instanceof n?e:new n(function(t,r){t(e)})}if(e&&!$jscomp.FORCE_POLYFILL_PROMISE)return e;t.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var t=this;this.asyncExecuteFunction(function(){t.executeBatch_()})}this.batch_.push(e)};var o=$jscomp.global.setTimeout;t.prototype.asyncExecuteFunction=function(e){o(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction(function(){throw e})};var n=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};n.prototype.createResolveAndReject_=function(){function e(e){return function(o){r||(r=!0,e.call(t,o))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},n.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof n)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},n.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},n.prototype.reject_=function(e){this.settle_(2,e)},n.prototype.fulfill_=function(e){this.settle_(1,e)},n.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,this.executeOnSettledCallbacks_()},n.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)s.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var s=new t;return n.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},n.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},n.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{o(e(t))}catch(e){s(e)}}:t}var o,s,a=new n(function(e,t){o=e,s=t});return this.callWhenSettled_(r(e,o),r(t,s)),a},n.prototype.catch=function(e){return this.then(void 0,e)},n.prototype.callWhenSettled_=function(e,t){function r(){switch(o.state_){case 1:e(o.result_);break;case 2:t(o.result_);break;default:throw Error("Unexpected state: "+o.state_)}}var o=this;null==this.onSettledCallbacks_?s.asyncExecute(r):this.onSettledCallbacks_.push(r)},n.resolve=r,n.reject=function(e){return new n(function(t,r){r(e)})},n.race=function(e){return new n(function(t,o){for(var n=$jscomp.makeIterator(e),s=n.next();!s.done;s=n.next())r(s.value).callWhenSettled_(t,o)})},n.all=function(e){var t=$jscomp.makeIterator(e),o=t.next();return o.done?r([]):new n(function(e,n){var s=[],a=0;do{s.push(void 0),a++,r(o.value).callWhenSettled_(function(t){return function(r){s[t]=r,0==--a&&e(s)}}(s.length-1),n),o=t.next()}while(!o.done)})},n},"es6","es3"),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.SymbolClass=function(e,t){this.$jscomp$symbol$id_=e,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:t})},$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_},$jscomp.Symbol=function(){function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(r||"")+"_"+t++,r)}var t=0;return e}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator")),"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}}),$jscomp.initSymbolIterator=function(){}},$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator")),$jscomp.initSymbolAsyncIterator=function(){}},$jscomp.iteratorPrototype=function(e){return $jscomp.initSymbolIterator(),e={next:e},e[$jscomp.global.Symbol.iterator]=function(){return this},e},$jscomp.underscoreProtoCanBeSet=function(){var e={a:!0},t={};try{return t.__proto__=e,t.a}catch(e){}return!1},$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,$jscomp.generator={},$jscomp.generator.ensureIteratorResultIsObject_=function(e){if(!(e instanceof Object))throw new TypeError("Iterator result "+e+" is not an object")},$jscomp.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1},$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},$jscomp.generator.Context.prototype.next_=function(e){this.yieldResult=e},$jscomp.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0},this.jumpToErrorHandler_()},$jscomp.generator.Context.prototype.return=function(e){this.abruptCompletion_={return:e},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(e){this.abruptCompletion_={jumpTo:e},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype.yield=function(e,t){return this.nextAddress=t,{value:e}},$jscomp.generator.Context.prototype.yieldAll=function(e,t){e=$jscomp.makeIterator(e);var r=e.next();if($jscomp.generator.ensureIteratorResultIsObject_(r),!r.done)return this.yieldAllIterator_=e,this.yield(r.value,t);this.yieldResult=r.value,this.nextAddress=t},$jscomp.generator.Context.prototype.jumpTo=function(e){this.nextAddress=e},$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(e,t){this.catchAddress_=e,void 0!=t&&(this.finallyAddress_=t)},$jscomp.generator.Context.prototype.setFinallyBlock=function(e){this.catchAddress_=0,this.finallyAddress_=e||0},$jscomp.generator.Context.prototype.leaveTryBlock=function(e,t){this.nextAddress=e,this.catchAddress_=t||0},$jscomp.generator.Context.prototype.enterCatchBlock=function(e){return this.catchAddress_=e||0,e=this.abruptCompletion_.exception,this.abruptCompletion_=null,e},$jscomp.generator.Context.prototype.enterFinallyBlock=function(e,t,r){r?this.finallyContexts_[r]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=e||0,this.finallyAddress_=t||0},$jscomp.generator.Context.prototype.leaveFinallyBlock=function(e,t){if(t=this.finallyContexts_.splice(t||0)[0],t=this.abruptCompletion_=this.abruptCompletion_||t){if(t.isException)return this.jumpToErrorHandler_();void 0!=t.jumpTo&&this.finallyAddress_<t.jumpTo?(this.nextAddress=t.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=e},$jscomp.generator.Context.prototype.forIn=function(e){return new $jscomp.generator.Context.PropertyIterator(e)},$jscomp.generator.Context.PropertyIterator=function(e){this.object_=e,this.properties_=[];for(var t in e)this.properties_.push(t);this.properties_.reverse()},$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var e=this.properties_.pop();if(e in this.object_)return e}return null},$jscomp.generator.Engine_=function(e){this.context_=new $jscomp.generator.Context,this.program_=e},$jscomp.generator.Engine_.prototype.next_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,e,this.context_.next_):(this.context_.next_(e),this.nextStep_())},$jscomp.generator.Engine_.prototype.return_=function(e){this.context_.start_();var t=this.context_.yieldAllIterator_;return t?this.yieldAllStep_("return"in t?t.return:function(e){return{value:e,done:!0}},e,this.context_.return):(this.context_.return(e),this.nextStep_())},$jscomp.generator.Engine_.prototype.throw_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,e,this.context_.next_):(this.context_.throw_(e),this.nextStep_())},$jscomp.generator.Engine_.prototype.yieldAllStep_=function(e,t,r){try{var o=e.call(this.context_.yieldAllIterator_,t);if($jscomp.generator.ensureIteratorResultIsObject_(o),!o.done)return this.context_.stop_(),o;var n=o.value}catch(e){return this.context_.yieldAllIterator_=null,this.context_.throw_(e),this.nextStep_()}return this.context_.yieldAllIterator_=null,r.call(this.context_,n),this.nextStep_()},$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var e=this.program_(this.context_);if(e)return this.context_.stop_(),{value:e.value,done:!1}}catch(e){this.context_.yieldResult=void 0,this.context_.throw_(e)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(e=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,e.isException)throw e.exception;return{value:e.return,done:!0}}return{value:void 0,done:!0}},$jscomp.generator.Generator_=function(e){this.next=function(t){return e.next_(t)},this.throw=function(t){return e.throw_(t)},this.return=function(t){return e.return_(t)},$jscomp.initSymbolIterator(),this[Symbol.iterator]=function(){return this}},$jscomp.generator.createGenerator=function(e,t){return t=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(t)),$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(t,e.prototype),t},$jscomp.asyncExecutePromiseGenerator=function(e){function t(t){return e.next(t)}function r(t){return e.throw(t)}return new Promise(function(o,n){function s(e){e.done?o(e.value):Promise.resolve(e.value).then(t,r).then(s,n)}s(e.next())})},$jscomp.asyncExecutePromiseGeneratorFunction=function(e){return $jscomp.asyncExecutePromiseGenerator(e())},$jscomp.asyncExecutePromiseGeneratorProgram=function(e){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(e)))};var canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),cw=canvas.width,ch=canvas.height,offsetX,offsetY;reOffset(),window.onscroll=function(e){reOffset()},window.onresize=function(e){reOffset()};for(var pressed=-1,score=0,images=[],gw=4,gh=4,phase,anim_frames=5,anim_length=30,anim_phase,anim,spawn,state,gameover,last=1,piece_frames={1:["weiss","weiss_1","weiss_1","weiss_1"],2:["schwarz","schwarz_1","schwarz_1","weiss_1"]},image_names="geraet2 b_up_sm b_down_sm b_left_sm b_right_sm reset 0 1 2 3 4 5 6 7 8 9 schwarz weiss weiss_1 weiss_0 schwarz_1 schwarz_0".split(" "),image_x_y=[["b_up_sm",19,8,31,8],["b_down_sm",19,53,31,8],["b_left_sm",8,19,8,31],["b_right_sm",53,19,8,31],["reset",60,55,6,6]],i=0;i<image_names.length;i++){var image=new Image;image.onload=function(){redraw()},image.src=image_names[i]+".png",images[image_names[i]]=image}var moving=!1;canvas.addEventListener("pointerdown",handleTap),document.addEventListener("keydown",handleKey),resetGame();</script> </body> </html>
